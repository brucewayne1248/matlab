<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="25,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T2U3">Ahat</span> = nearestSPD(<span class="var type1" id="S3T2U6">A</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="25,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% nearestSPD - the nearest (in Frobenius norm) Symmetric Positive Definite matrix to A</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% usage: Ahat = nearestSPD(A)</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% From Higham: "The nearest symmetric positive semidefinite matrix in the</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% Frobenius norm to an arbitrary real matrix A is shown to be (B + H)/2,</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% where H is the symmetric polar factor of B=(A + A')/2."</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% http://www.sciencedirect.com/science/article/pii/0024379588902236</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,10" id="srcline10">10</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,11" id="srcline11">11</a></span><span class="line"><span class="comment">% arguments: (input)</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,12" id="srcline12">12</a></span><span class="line"><span class="comment">%  A - square matrix, which will be converted to the nearest Symmetric</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,13" id="srcline13">13</a></span><span class="line"><span class="comment">%    Positive Definite Matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,14" id="srcline14">14</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,15" id="srcline15">15</a></span><span class="line"><span class="comment">% Arguments: (output)</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,16" id="srcline16">16</a></span><span class="line"><span class="comment">%  Ahat - The matrix chosen as the nearest SPD matrix to A.</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,18" id="srcline18">18</a></span><span class="line"><span class="keyword">if</span> nargin ~= 1</span></span>
<span class="srcline"><span class="lineno"><a href="25,19" id="srcline19">19</a></span><span class="line">  error(<span class="string">'Exactly one argument must be provided.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="25,20" id="srcline20">20</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,22" id="srcline22">22</a></span><span class="line"><span class="comment">% test for a square matrix A</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T3:U3">[<span class="var type1" id="S6T3U20">r</span>,<span class="var type1" id="S7T3U21">c</span>] = size(<span class="var type1" id="S3T2U24">A</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,24" id="srcline24">24</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S6T3U28">r</span> ~= <span class="var type1" id="S7T3U29">c</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,25" id="srcline25">25</a></span><span class="line">  error(<span class="string">'A must be a square matrix.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="25,26" id="srcline26">26</a></span><span class="line"><span class="keyword">elseif</span> (<span class="var type1" id="S6T3U38">r</span> == 1) &amp;&amp; (<span class="var type0" id="S3T0U42">A</span> &lt;= 0)</span></span>
<span class="srcline"><span class="lineno"><a href="25,27" id="srcline27">27</a></span><span class="line">  <span class="comment">% A was scalar and non-positive, so just return eps</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,28" id="srcline28">28</a></span><span class="line">  <span class="var type0" id="S2T0U46">Ahat</span> = eps;</span></span>
<span class="srcline"><span class="lineno"><a href="25,29" id="srcline29">29</a></span><span class="line">  <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,30" id="srcline30">30</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,32" id="srcline32">32</a></span><span class="line"><span class="comment">% symmetrize A into B</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T2:U10"><span class="var type1" id="S10T2U52">B</span> = <span class="mxinfo " id="T2:U12">(<span class="mxinfo " id="T2:U13"><span class="var type1" id="S3T2U56">A</span> + <span class="mxinfo " id="T2:U15"><span class="var type1" id="S3T2U58">A</span>'</span></span>)/<span class="mxinfo " id="T3:U17">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,35" id="srcline35">35</a></span><span class="line"><span class="comment">% Compute the symmetric polar factor of B. Call it H.</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,36" id="srcline36">36</a></span><span class="line"><span class="comment">% Clearly H is itself SPD.</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,37" id="srcline37">37</a></span><span class="line">[<span class="var type1" id="S11T2U63">U</span>,<span class="var type1" id="S12T2U64">Sigma</span>,<span class="var type1" id="S13T2U65">V</span>] = svd(<span class="var type1" id="S10T2U68">B</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="25,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T2:U22"><span class="var type1" id="S15T2U71">H</span> = <span class="mxinfo " id="T2:U24"><span class="mxinfo " id="T2:U25"><span class="var type1" id="S13T2U74">V</span>*<span class="var type1" id="S12T2U75">Sigma</span></span>*<span class="mxinfo " id="T2:U28"><span class="var type1" id="S13T2U77">V</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,40" id="srcline40">40</a></span><span class="line"><span class="comment">% get Ahat in the above formula</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T2:U30"><span class="var type1" id="S2T2U80">Ahat</span> = <span class="mxinfo " id="T2:U32">(<span class="mxinfo " id="T2:U33"><span class="var type1" id="S10T2U84">B</span>+<span class="var type1" id="S15T2U85">H</span></span>)/<span class="mxinfo " id="T3:U36">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,43" id="srcline43">43</a></span><span class="line"><span class="comment">% ensure symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo " id="T2:U37"><span class="var type1" id="S2T2U89">Ahat</span> = <span class="mxinfo " id="T2:U39">(<span class="mxinfo " id="T2:U40"><span class="var type1" id="S2T2U93">Ahat</span> + <span class="mxinfo " id="T2:U42"><span class="var type1" id="S2T2U95">Ahat</span>'</span></span>)/<span class="mxinfo " id="T3:U44">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,46" id="srcline46">46</a></span><span class="line"><span class="comment">% test that Ahat is in fact PD. if it is not so, then tweak it just a bit.</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo " id="T3:U45"><span class="var type1" id="S16T3U99">p</span> = <span class="mxinfo " id="T3:U47">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo " id="T3:U48"><span class="var type1" id="S17T3U103">k</span> = <span class="mxinfo " id="T3:U50">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,49" id="srcline49">49</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo " id="T8:U51"><span class="var type1" id="S16T3U107">p</span> ~= <span class="mxinfo " id="T3:U53">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="25,50" id="srcline50">50</a></span><span class="line">  [<span class="var type1" id="S18T23U112">R</span>,<span class="var type1" id="S16T3U113">p</span>] = chol(<span class="var type1" id="S2T2U116">Ahat</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="25,51" id="srcline51">51</a></span><span class="line">  <span class="mxinfo " id="T3:U57"><span class="var type1" id="S17T3U119">k</span> = <span class="mxinfo " id="T3:U59"><span class="var type1" id="S17T3U121">k</span> + <span class="mxinfo " id="T3:U61">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,52" id="srcline52">52</a></span><span class="line">  <span class="keyword">if</span> <span class="mxinfo " id="T8:U62"><span class="var type1" id="S16T3U126">p</span> ~= <span class="mxinfo " id="T3:U64">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="25,53" id="srcline53">53</a></span><span class="line">    <span class="comment">% Ahat failed the chol test. It must have been just a hair off,</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,54" id="srcline54">54</a></span><span class="line">    <span class="comment">% due to floating point trash, so it is simplest now just to</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,55" id="srcline55">55</a></span><span class="line">    <span class="comment">% tweak by adding a tiny multiple of an identity matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,56" id="srcline56">56</a></span><span class="line">    <span class="mxinfo " id="T24:U65"><span class="var type1" id="S20T24U130">mineig</span> = <span class="mxinfo " id="T24:U67">min(<span class="mxinfo " id="T25:U68">eig(<span class="var type1" id="S2T2U135">Ahat</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo " id="T2:U70"><span class="var type1" id="S2T2U138"><span class="message error" id="M2F39C">Ahat</span></span></span> = <span class="mxinfo " id="T26:U71"><span class="var type1" id="S2T2U140">Ahat</span> + <span class="mxinfo " id="T26:U73">(<span class="mxinfo " id="T24:U74"><span class="mxinfo " id="T24:U75"><span class="mxinfo " id="T24:U76">-<span class="var type1" id="S20T24U146">mineig</span></span>*<span class="mxinfo " id="T3:U78"><span class="var type1" id="S17T3U148">k</span>.^2</span></span> + <span class="mxinfo " id="T3:U80">eps(<span class="var type1" id="S20T24U152">mineig</span>)</span></span>)*<span class="mxinfo " id="T2:U82">eye(<span class="mxinfo " id="T27:U83">size(<span class="var type1" id="S3T2U157">A</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="25,58" id="srcline58">58</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="25,59" id="srcline59">59</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="25,60" id="srcline60">60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,61" id="srcline61">61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,62" id="srcline62">62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,63" id="srcline63">63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,64" id="srcline64">64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="25,65" id="srcline65">65</a></span><span class="line"></span></span>
</pre>
