<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">x</span>, <span class="var type1" id="S3T2U4">test</span>] = unscented_kalman_filter(<span class="var type1" id="S4T3U7">P</span>, <span class="var type1" id="S5T2U8">Q</span>, <span class="var type1" id="S6T4U9">R</span>, <span class="var type1" id="S7T1U10">x0</span>, <span class="var type1" id="S8T4U11">alpha_ukf</span>, <span class="var type1" id="S9T4U12">beta_ukf</span>, <span class="var type1" id="S10T4U13">kappa_ukf</span>, <span class="var type1" id="S11T5U14">para_sys</span>, <span class="var type1" id="S12T4U15">T</span>, <span class="var type1" id="S13T4U16">u</span>, <span class="var type1" id="S14T4U17">y</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% Unscented Kalman Filter (UKF) fuer nichtlineare Systeme</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% Das UKF praediziert den Zustand eines nichtliniearen Systems durch</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Mittelung sog. Sigma Punkte. Dazu werden 2n+1 Sigmapunkte (moegliche</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% Zustaende des Systems) mittels Kovarianzmatrix P berechnet und fuer jeden</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% Sigmapunkt mithilfe der Zustandsgleichung ein neuer Zustand praediziert.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% Diese werden gewichtet gemittelt und mit deren Hilfe die neuen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% Kovarianzmatrizen, die Rueckfuehrmatrix K und die Zustaende ermittelt.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% Weitere Infos unter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% http://www.agnld.uni-potsdam.de/~shw/TSA/Tools/UKF/node4.html</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% http://cslu.cse.ogi.edu/nsel/ukf/node6.html</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% Tipp: kappa meist zu 0 waehlen, alpha sehr klein bspw. 0.001, beta bei</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% Gaussverteilung = 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% -alpha bestimmt die Streuung der Sigma-Punkte um den Mittelwert</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">% -beta wird benutzt, um Wissen ueber die Verteilung aufzunehmen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% -kappa ist ein sekundaerer skalierender Parameter, der gewoehnlich </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% gleich 0 oder 3-n gesetzt wird</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% Vorlage von Matthias Dagen, September 2009, veraendert durch David</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% Klinkenbuss</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S15T1U19">x_p</span> <span class="var type1" id="S16T3U20">P_p</span> <span class="var type1" id="S17T6U21">x0_sig</span> <span class="var type1" id="S18T6U22">x_sig</span> <span class="var type1" id="S19T7U23">W_m</span> <span class="var type1" id="S20T7U24">W_c</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">% Parameter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T2:U20"><span class="var type1" id="S3T2U27">test</span> = <span class="mxinfo " id="T2:U22">zeros(<span class="mxinfo " id="T4:U23">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T4:U24"><span class="var type1" id="S22T4U33">g</span> = <span class="mxinfo " id="T4:U26"><span class="var type1" id="S11T5U35">para_sys</span>(<span class="mxinfo " id="T4:U28">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T4:U29"><span class="var type1" id="S23T4U39">l_1</span> = <span class="mxinfo " id="T4:U31"><span class="var type1" id="S11T5U41">para_sys</span>(<span class="mxinfo " id="T8:U33">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T4:U34"><span class="var type1" id="S24T4U45">l_2</span> = <span class="mxinfo " id="T4:U36"><span class="var type1" id="S11T5U47">para_sys</span>(<span class="mxinfo " id="T8:U38">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T4:U39"><span class="var type1" id="S25T4U51">m_1</span> = <span class="mxinfo " id="T4:U41"><span class="var type1" id="S11T5U53">para_sys</span>(<span class="mxinfo " id="T4:U43">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T4:U44"><span class="var type1" id="S26T4U57">m_2</span> = <span class="mxinfo " id="T4:U46"><span class="var type1" id="S11T5U59">para_sys</span>(<span class="mxinfo " id="T8:U48">5</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo " id="T4:U49"><span class="var type1" id="S27T4U63">m_3</span> = <span class="mxinfo " id="T4:U51"><span class="var type1" id="S11T5U65">para_sys</span>(<span class="mxinfo " id="T4:U53">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T4:U54"><span class="var type1" id="S28T4U69">d_p1</span> = <span class="mxinfo " id="T4:U56"><span class="var type1" id="S11T5U71">para_sys</span>(<span class="mxinfo " id="T4:U58">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T4:U59"><span class="var type1" id="S29T4U75">d_p2</span> = <span class="mxinfo " id="T4:U61"><span class="var type1" id="S11T5U77">para_sys</span>(<span class="mxinfo " id="T4:U63">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T4:U64"><span class="var type1" id="S30T4U81">n_ukf</span>  = <span class="mxinfo " id="T4:U66">4</span></span>;     <span class="comment">% Laenge von f(x)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo " id="T4:U67"><span class="var type1" id="S31T4U85">o_ukf</span> = <span class="mxinfo " id="T4:U69">1</span></span>;      <span class="comment">% Anzahl der zurueckgefuehrten Variablen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T9:U70">isempty(<span class="var type0" id="S15T0U96">x_p</span>)</span> || <span class="mxinfo " id="T9:U71">isempty(<span class="var type0" id="S16T0U99">P_p</span>)</span> || <span class="mxinfo " id="T9:U72">isempty(<span class="var type0" id="S17T0U102">x0_sig</span>)</span> || <span class="mxinfo " id="T9:U73">isempty(<span class="var type0" id="S18T0U105">x_sig</span>)</span> || <span class="mxinfo " id="T9:U74">isempty(<span class="var type0" id="S19T0U108">W_m</span>)</span> || <span class="mxinfo " id="T9:U75">isempty(<span class="var type0" id="S20T0U111">W_c</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">    <span class="mxinfo " id="T1:U76"><span class="var type1" id="S15T1U114">x_p</span> = <span class="var type1" id="S7T1U115">x0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo " id="T3:U79"><span class="var type1" id="S16T3U118">P_p</span> = <span class="var type1" id="S4T3U119">P</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">    <span class="mxinfo " id="T6:U82"><span class="var type1" id="S17T6U122">x0_sig</span> = <span class="mxinfo " id="T6:U84">zeros(<span class="var type1" id="S30T4U125">n_ukf</span>,<span class="mxinfo " id="T4:U86">2*<span class="var type1" id="S30T4U129">n_ukf</span>+1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">    <span class="mxinfo " id="T6:U88"><span class="var type1" id="S18T6U133">x_sig</span>  = <span class="mxinfo " id="T6:U90">zeros(<span class="var type1" id="S30T4U136">n_ukf</span>,<span class="mxinfo " id="T4:U92">2*<span class="var type1" id="S30T4U140">n_ukf</span>+1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">    <span class="mxinfo " id="T7:U94"><span class="var type1" id="S19T7U144">W_m</span> = <span class="mxinfo " id="T7:U96">zeros(<span class="mxinfo " id="T4:U97">1</span>,<span class="mxinfo " id="T4:U98">2*<span class="var type1" id="S30T4U151">n_ukf</span>+1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">    <span class="mxinfo " id="T7:U100"><span class="var type1" id="S20T7U155">W_c</span> = <span class="mxinfo " id="T7:U102">zeros(<span class="mxinfo " id="T4:U103">1</span>,<span class="mxinfo " id="T4:U104">2*<span class="var type1" id="S30T4U162">n_ukf</span>+1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo " id="T1:U106"><span class="var type1" id="S2T1U166">x</span> = <span class="var type1" id="S15T1U167">x_p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%% Parameter-Initialization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo " id="T4:U109"><span class="var type1" id="S33T4U171">lambda_ukf</span> = <span class="mxinfo " id="T4:U111"><span class="mxinfo " id="T4:U112">(<span class="mxinfo " id="T4:U113"><span class="var type1" id="S8T4U176">alpha_ukf</span>^2</span>)*(<span class="mxinfo " id="T4:U115"><span class="var type1" id="S30T4U180">n_ukf</span>+<span class="var type1" id="S10T4U181">kappa_ukf</span></span>)</span>-<span class="var type1" id="S30T4U182">n_ukf</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%% Weight calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T4:U119"><span class="mxinfo " id="T4:U120"><span class="var type1" id="S19T7U186">W_m</span>(<span class="mxinfo " id="T4:U122">1</span>,<span class="mxinfo " id="T4:U123">1</span>)</span> = <span class="mxinfo " id="T4:U124"><span class="var type1" id="S33T4U190">lambda_ukf</span>/(<span class="mxinfo " id="T4:U126"><span class="var type1" id="S30T4U193">n_ukf</span>+<span class="var type1" id="S33T4U194">lambda_ukf</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo " id="T4:U129"><span class="mxinfo " id="T4:U130"><span class="var type1" id="S20T7U198">W_c</span>(<span class="mxinfo " id="T4:U132">1</span>,<span class="mxinfo " id="T4:U133">1</span>)</span> = <span class="mxinfo " id="T4:U134"><span class="mxinfo " id="T4:U135"><span class="mxinfo " id="T4:U136"><span class="mxinfo " id="T4:U137"><span class="var type1" id="S33T4U205">lambda_ukf</span>/(<span class="mxinfo " id="T4:U139"><span class="var type1" id="S30T4U208">n_ukf</span>+<span class="var type1" id="S33T4U209">lambda_ukf</span></span>)</span>+<span class="mxinfo " id="T4:U142">1</span></span>-<span class="mxinfo " id="T4:U143"><span class="var type1" id="S8T4U212">alpha_ukf</span>^2</span></span>+<span class="var type1" id="S9T4U214">beta_ukf</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T4U217">i</span>=<span class="mxinfo " id="T5:U147"><span class="mxinfo " id="T4:U148">2</span>:2*<span class="var type1" id="S30T4U223">n_ukf</span>+1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">    <span class="mxinfo " id="T4:U150"><span class="mxinfo " id="T4:U151"><span class="var type1" id="S19T7U228">W_m</span>(<span class="mxinfo " id="T4:U153">1</span>,<span class="var type1" id="S34T4U230">i</span>)</span> = <span class="mxinfo " id="T4:U155"><span class="mxinfo " id="T4:U156">1</span>/(<span class="mxinfo " id="T4:U157"><span class="mxinfo " id="T4:U158">2</span>*(<span class="mxinfo " id="T4:U159"><span class="var type1" id="S30T4U238">n_ukf</span>+<span class="var type1" id="S33T4U239">lambda_ukf</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo " id="T4:U162"><span class="mxinfo " id="T4:U163"><span class="var type1" id="S20T7U243">W_c</span>(<span class="mxinfo " id="T4:U165">1</span>,<span class="var type1" id="S34T4U245">i</span>)</span> = <span class="mxinfo " id="T4:U167"><span class="mxinfo " id="T4:U168">1</span>/(<span class="mxinfo " id="T4:U169"><span class="mxinfo " id="T4:U170">2</span>*(<span class="mxinfo " id="T4:U171"><span class="var type1" id="S30T4U253">n_ukf</span>+<span class="var type1" id="S33T4U254">lambda_ukf</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%% 2n+1 Sigma Points calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T3:U174"><span class="var type1" id="S35T3U257">P_an</span> = <span class="mxinfo " id="T3:U176">(<span class="mxinfo " id="T3:U177"><span class="mxinfo " id="T4:U178">sqrt(<span class="mxinfo " id="T4:U179"><span class="var type1" id="S30T4U264">n_ukf</span>+<span class="var type1" id="S33T4U265">lambda_ukf</span></span>)</span>.*<span class="mxinfo " id="T3:U182">chol(<span class="var type1" id="S16T3U268">P_p</span>)</span></span>)'</span></span>; <span class="comment">% Wurzelmatrix mittels Cholesky-Zerlegung</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo " id="T1:U184"><span class="mxinfo " id="T1:U185"><span class="var type1" id="S17T6U272">x0_sig</span>(<span class="mxinfo " id="T10:U187">:</span>,<span class="mxinfo " id="T4:U188">1</span>)</span> = <span class="var type1" id="S15T1U275">x_p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T4U278">i</span>=<span class="mxinfo " id="T1:U191"><span class="mxinfo " id="T4:U192">2</span>:<span class="var type1" id="S30T4U282">n_ukf</span>+1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">    <span class="var type0" id="S17T0U287">x0_sig</span>(:,<span class="var type0" id="S34T0U289">i</span>)     = <span class="message error" id="M1F1C"><span class="var type1" id="S15T1U291">x_p</span> + <span class="mxinfo " id="T11:U195"><span class="var type1" id="S35T3U293">P_an</span>(<span class="mxinfo " id="T12:U197">:</span>,<span class="mxinfo " id="T4:U198"><span class="var type1" id="S34T4U296">i</span>-<span class="mxinfo " id="T4:U200">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">    <span class="var type0" id="S17T0U301">x0_sig</span>(:,<span class="var type0" id="S30T0U304">n_ukf</span>+<span class="var type0" id="S34T0U305">i</span>)   = <span class="message error" id="M2F1C"><span class="var type1" id="S15T1U307">x_p</span> - <span class="mxinfo " id="T11:U202"><span class="var type1" id="S35T3U309">P_an</span>(<span class="mxinfo " id="T12:U204">:</span>,<span class="mxinfo " id="T4:U205"><span class="var type1" id="S34T4U312">i</span>-<span class="mxinfo " id="T4:U207">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%% Unscented Kalman filter time update equations</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T4U316">i</span> = <span class="mxinfo " id="T11:U209"><span class="mxinfo " id="T4:U210">1</span>:(2*<span class="var type1" id="S30T4U323">n_ukf</span>+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"> <span class="mxinfo " id="T4:U212"><span class="var type1" id="S38T4U327">x_1</span> = <span class="mxinfo " id="T4:U214"><span class="var type1" id="S17T6U329">x0_sig</span>(<span class="mxinfo " id="T8:U216">1</span>,<span class="var type1" id="S34T4U331">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"> <span class="mxinfo " id="T4:U218"><span class="var type1" id="S39T4U334">x_2</span> = <span class="mxinfo " id="T4:U220"><span class="var type1" id="S17T6U336">x0_sig</span>(<span class="mxinfo " id="T8:U222">2</span>,<span class="var type1" id="S34T4U338">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"> <span class="mxinfo " id="T4:U224"><span class="var type1" id="S40T4U341">x_3</span> = <span class="mxinfo " id="T4:U226"><span class="var type1" id="S17T6U343">x0_sig</span>(<span class="mxinfo " id="T8:U228">3</span>,<span class="var type1" id="S34T4U345">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"> <span class="mxinfo " id="T4:U230"><span class="var type1" id="S41T4U348">x_4</span> = <span class="mxinfo " id="T4:U232"><span class="var type1" id="S17T6U350">x0_sig</span>(<span class="mxinfo " id="T8:U234">4</span>,<span class="var type1" id="S34T4U352">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo " id="T1:U236"><span class="mxinfo " id="T1:U237"><span class="var type1" id="S18T6U356">x_sig</span>(<span class="mxinfo " id="T10:U239">:</span>,<span class="var type1" id="S34T4U358">i</span>)</span> = <span class="mxinfo " id="T1:U241">[<span class="mxinfo " id="T4:U242"><span class="var type1" id="S38T4U362">x_1</span> + <span class="mxinfo " id="T4:U244"><span class="var type1" id="S12T4U364">T</span>*<span class="var type1" id="S39T4U365">x_2</span></span></span>;<span class="mxinfo " id="T4:U247"><span class="var type1" id="S39T4U368">x_2</span> + <span class="mxinfo " id="T4:U249">(<span class="mxinfo " id="T4:U250"><span class="var type1" id="S12T4U372">T</span>*(<span class="mxinfo " id="T4:U252"><span class="mxinfo " id="T4:U253"><span class="mxinfo " id="T4:U254"><span class="mxinfo " id="T4:U255"><span class="mxinfo " id="T4:U256"><span class="mxinfo " id="T4:U257"><span class="mxinfo " id="T4:U258"><span class="mxinfo " id="T4:U259"><span class="mxinfo " id="T4:U260"><span class="mxinfo " id="T4:U261"><span class="mxinfo " id="T4:U262"><span class="mxinfo " id="T4:U263"><span class="mxinfo " id="T4:U264"><span class="mxinfo " id="T4:U265">12</span>*<span class="var type1" id="S29T4U388">d_p2</span></span>*<span class="var type1" id="S24T4U389">l_2</span></span>*<span class="var type1" id="S41T4U390">x_4</span></span> - <span class="mxinfo " id="T4:U269"><span class="mxinfo " id="T4:U270"><span class="mxinfo " id="T4:U271"><span class="mxinfo " id="T4:U272">12</span>*<span class="var type1" id="S28T4U395">d_p1</span></span>*<span class="var type1" id="S24T4U396">l_2</span></span>*<span class="var type1" id="S39T4U397">x_2</span></span></span> - <span class="mxinfo " id="T4:U276"><span class="mxinfo " id="T4:U277"><span class="mxinfo " id="T4:U278"><span class="mxinfo " id="T4:U279">12</span>*<span class="var type1" id="S29T4U402">d_p2</span></span>*<span class="var type1" id="S24T4U403">l_2</span></span>*<span class="var type1" id="S39T4U404">x_2</span></span></span> - <span class="mxinfo " id="T4:U283"><span class="mxinfo " id="T4:U284">cos(<span class="mxinfo " id="T4:U285"><span class="var type1" id="S38T4U409">x_1</span> - <span class="var type1" id="S40T4U410">x_3</span></span>)</span>*(<span class="mxinfo " id="T4:U288"><span class="mxinfo " id="T4:U289"><span class="mxinfo " id="T4:U290"><span class="mxinfo " id="T4:U291"><span class="mxinfo " id="T4:U292"><span class="mxinfo " id="T4:U293"><span class="mxinfo " id="T4:U294"><span class="mxinfo " id="T4:U295">18</span>*<span class="var type1" id="S29T4U420">d_p2</span></span>*<span class="var type1" id="S23T4U421">l_1</span></span>*<span class="var type1" id="S39T4U422">x_2</span></span> - <span class="mxinfo " id="T4:U299"><span class="mxinfo " id="T4:U300"><span class="mxinfo " id="T4:U301"><span class="mxinfo " id="T4:U302">18</span>*<span class="var type1" id="S29T4U427">d_p2</span></span>*<span class="var type1" id="S23T4U428">l_1</span></span>*<span class="var type1" id="S41T4U429">x_4</span></span></span> + <span class="mxinfo " id="T4:U306"><span class="mxinfo " id="T4:U307"><span class="mxinfo " id="T4:U308"><span class="mxinfo " id="T4:U309"><span class="mxinfo " id="T4:U310"><span class="mxinfo " id="T4:U311">9</span>*<span class="var type1" id="S23T4U436">l_1</span></span>*<span class="var type1" id="S24T4U437">l_2</span></span>*<span class="var type1" id="S26T4U438">m_2</span></span>*<span class="var type1" id="S13T4U439">u</span></span>*<span class="mxinfo " id="T4:U316">cos(<span class="var type1" id="S40T4U442">x_3</span>)</span></span></span> + <span class="mxinfo " id="T4:U318"><span class="mxinfo " id="T4:U319"><span class="mxinfo " id="T4:U320"><span class="mxinfo " id="T4:U321"><span class="mxinfo " id="T4:U322"><span class="mxinfo " id="T4:U323">9</span>*<span class="var type1" id="S22T4U449">g</span></span>*<span class="var type1" id="S23T4U450">l_1</span></span>*<span class="var type1" id="S24T4U451">l_2</span></span>*<span class="var type1" id="S26T4U452">m_2</span></span>*<span class="mxinfo " id="T4:U328">sin(<span class="var type1" id="S40T4U455">x_3</span>)</span></span></span> + <span class="mxinfo " id="T4:U330"><span class="mxinfo " id="T4:U331"><span class="mxinfo " id="T4:U332"><span class="mxinfo " id="T4:U333"><span class="mxinfo " id="T4:U334"><span class="mxinfo " id="T4:U335">9</span>*<span class="mxinfo " id="T4:U336"><span class="var type1" id="S23T4U463">l_1</span>^2</span></span>*<span class="var type1" id="S24T4U465">l_2</span></span>*<span class="var type1" id="S26T4U466">m_2</span></span>*<span class="mxinfo " id="T4:U340"><span class="var type1" id="S39T4U468">x_2</span>^2</span></span>*<span class="mxinfo " id="T4:U342">sin(<span class="mxinfo " id="T4:U343"><span class="var type1" id="S38T4U473">x_1</span> - <span class="var type1" id="S40T4U474">x_3</span></span>)</span></span></span>)</span></span> + <span class="mxinfo " id="T4:U346"><span class="mxinfo " id="T4:U347"><span class="mxinfo " id="T4:U348"><span class="mxinfo " id="T4:U349"><span class="mxinfo " id="T4:U350"><span class="mxinfo " id="T4:U351">6</span>*<span class="var type1" id="S23T4U481">l_1</span></span>*<span class="var type1" id="S24T4U482">l_2</span></span>*<span class="var type1" id="S25T4U483">m_1</span></span>*<span class="var type1" id="S13T4U484">u</span></span>*<span class="mxinfo " id="T4:U356">cos(<span class="var type1" id="S38T4U487">x_1</span>)</span></span></span> + <span class="mxinfo " id="T4:U358"><span class="mxinfo " id="T4:U359"><span class="mxinfo " id="T4:U360"><span class="mxinfo " id="T4:U361"><span class="mxinfo " id="T4:U362"><span class="mxinfo " id="T4:U363">12</span>*<span class="var type1" id="S23T4U494">l_1</span></span>*<span class="var type1" id="S24T4U495">l_2</span></span>*<span class="var type1" id="S26T4U496">m_2</span></span>*<span class="var type1" id="S13T4U497">u</span></span>*<span class="mxinfo " id="T4:U368">cos(<span class="var type1" id="S38T4U500">x_1</span>)</span></span></span> + <span class="mxinfo " id="T4:U370"><span class="mxinfo " id="T4:U371"><span class="mxinfo " id="T4:U372"><span class="mxinfo " id="T4:U373"><span class="mxinfo " id="T4:U374"><span class="mxinfo " id="T4:U375">12</span>*<span class="var type1" id="S23T4U507">l_1</span></span>*<span class="var type1" id="S24T4U508">l_2</span></span>*<span class="var type1" id="S27T4U509">m_3</span></span>*<span class="var type1" id="S13T4U510">u</span></span>*<span class="mxinfo " id="T4:U380">cos(<span class="var type1" id="S38T4U513">x_1</span>)</span></span></span> + <span class="mxinfo " id="T4:U382"><span class="mxinfo " id="T4:U383"><span class="mxinfo " id="T4:U384"><span class="mxinfo " id="T4:U385"><span class="mxinfo " id="T4:U386"><span class="mxinfo " id="T4:U387">6</span>*<span class="var type1" id="S22T4U520">g</span></span>*<span class="var type1" id="S23T4U521">l_1</span></span>*<span class="var type1" id="S24T4U522">l_2</span></span>*<span class="var type1" id="S25T4U523">m_1</span></span>*<span class="mxinfo " id="T4:U392">sin(<span class="var type1" id="S38T4U526">x_1</span>)</span></span></span> + <span class="mxinfo " id="T4:U394"><span class="mxinfo " id="T4:U395"><span class="mxinfo " id="T4:U396"><span class="mxinfo " id="T4:U397"><span class="mxinfo " id="T4:U398"><span class="mxinfo " id="T4:U399">12</span>*<span class="var type1" id="S22T4U533">g</span></span>*<span class="var type1" id="S23T4U534">l_1</span></span>*<span class="var type1" id="S24T4U535">l_2</span></span>*<span class="var type1" id="S26T4U536">m_2</span></span>*<span class="mxinfo " id="T4:U404">sin(<span class="var type1" id="S38T4U539">x_1</span>)</span></span></span> + <span class="mxinfo " id="T4:U406"><span class="mxinfo " id="T4:U407"><span class="mxinfo " id="T4:U408"><span class="mxinfo " id="T4:U409"><span class="mxinfo " id="T4:U410"><span class="mxinfo " id="T4:U411">12</span>*<span class="var type1" id="S22T4U546">g</span></span>*<span class="var type1" id="S23T4U547">l_1</span></span>*<span class="var type1" id="S24T4U548">l_2</span></span>*<span class="var type1" id="S27T4U549">m_3</span></span>*<span class="mxinfo " id="T4:U416">sin(<span class="var type1" id="S38T4U552">x_1</span>)</span></span></span> - <span class="mxinfo " id="T4:U418"><span class="mxinfo " id="T4:U419"><span class="mxinfo " id="T4:U420"><span class="mxinfo " id="T4:U421"><span class="mxinfo " id="T4:U422"><span class="mxinfo " id="T4:U423">6</span>*<span class="var type1" id="S23T4U559">l_1</span></span>*<span class="mxinfo " id="T4:U425"><span class="var type1" id="S24T4U561">l_2</span>^2</span></span>*<span class="var type1" id="S26T4U563">m_2</span></span>*<span class="mxinfo " id="T4:U428"><span class="var type1" id="S41T4U565">x_4</span>^2</span></span>*<span class="mxinfo " id="T4:U430">sin(<span class="mxinfo " id="T4:U431"><span class="var type1" id="S38T4U570">x_1</span> - <span class="var type1" id="S40T4U571">x_3</span></span>)</span></span></span>)</span>)/(<span class="mxinfo " id="T4:U434"><span class="mxinfo " id="T4:U435"><span class="mxinfo " id="T4:U436"><span class="var type1" id="S23T4U576">l_1</span>^2</span>*<span class="var type1" id="S24T4U578">l_2</span></span>*(<span class="mxinfo " id="T4:U439"><span class="mxinfo " id="T4:U440"><span class="mxinfo " id="T4:U441"><span class="mxinfo " id="T4:U442"><span class="mxinfo " id="T4:U443">4</span>*<span class="var type1" id="S25T4U585">m_1</span></span> + <span class="mxinfo " id="T4:U445"><span class="mxinfo " id="T4:U446">12</span>*<span class="var type1" id="S26T4U588">m_2</span></span></span> + <span class="mxinfo " id="T4:U448"><span class="mxinfo " id="T4:U449">12</span>*<span class="var type1" id="S27T4U591">m_3</span></span></span> - <span class="mxinfo " id="T4:U451"><span class="mxinfo " id="T4:U452"><span class="mxinfo " id="T4:U453">9</span>*<span class="var type1" id="S26T4U595">m_2</span></span>*<span class="mxinfo " id="T4:U455"><span class="mxinfo " id="T4:U456">cos(<span class="mxinfo " id="T4:U457"><span class="var type1" id="S38T4U600">x_1</span> - <span class="var type1" id="S40T4U601">x_3</span></span>)</span>^2</span></span></span>)</span>)</span></span>;<span class="mxinfo " id="T4:U460"><span class="var type1" id="S40T4U605">x_3</span> + <span class="mxinfo " id="T4:U462"><span class="var type1" id="S12T4U607">T</span>*<span class="var type1" id="S41T4U608">x_4</span></span></span>;<span class="mxinfo " id="T4:U465"><span class="var type1" id="S41T4U611">x_4</span> + <span class="mxinfo " id="T4:U467">(<span class="mxinfo " id="T4:U468"><span class="var type1" id="S12T4U615">T</span>*(<span class="mxinfo " id="T4:U470"><span class="mxinfo " id="T4:U471"><span class="mxinfo " id="T4:U472"><span class="mxinfo " id="T4:U473"><span class="mxinfo " id="T4:U474"><span class="mxinfo " id="T4:U475"><span class="mxinfo " id="T4:U476"><span class="mxinfo " id="T4:U477"><span class="mxinfo " id="T4:U478"><span class="mxinfo " id="T4:U479"><span class="mxinfo " id="T4:U480"><span class="mxinfo " id="T4:U481"><span class="mxinfo " id="T4:U482"><span class="mxinfo " id="T4:U483"><span class="mxinfo " id="T4:U484"><span class="mxinfo " id="T4:U485"><span class="mxinfo " id="T4:U486"><span class="mxinfo " id="T4:U487"><span class="mxinfo " id="T4:U488"><span class="mxinfo " id="T4:U489"><span class="mxinfo " id="T4:U490"><span class="mxinfo " id="T4:U491"><span class="mxinfo " id="T4:U492"><span class="mxinfo " id="T4:U493">sin(<span class="mxinfo " id="T4:U494"><span class="var type1" id="S38T4U643">x_1</span> - <span class="var type1" id="S40T4U644">x_3</span></span>)</span>*(<span class="mxinfo " id="T4:U497"><span class="mxinfo " id="T4:U498"><span class="mxinfo " id="T4:U499"><span class="mxinfo " id="T4:U500"><span class="mxinfo " id="T4:U501"><span class="mxinfo " id="T4:U502"><span class="mxinfo " id="T4:U503">36</span>*<span class="mxinfo " id="T4:U504"><span class="var type1" id="S23T4U654">l_1</span>^2</span></span>*<span class="var type1" id="S24T4U656">l_2</span></span>*<span class="mxinfo " id="T4:U507"><span class="var type1" id="S26T4U658">m_2</span>^2</span></span>*<span class="mxinfo " id="T4:U509"><span class="var type1" id="S39T4U661">x_2</span>^2</span></span> + <span class="mxinfo " id="T4:U511"><span class="mxinfo " id="T4:U512"><span class="mxinfo " id="T4:U513"><span class="mxinfo " id="T4:U514"><span class="mxinfo " id="T4:U515"><span class="mxinfo " id="T4:U516">12</span>*<span class="mxinfo " id="T4:U517"><span class="var type1" id="S23T4U670">l_1</span>^2</span></span>*<span class="var type1" id="S24T4U672">l_2</span></span>*<span class="var type1" id="S25T4U673">m_1</span></span>*<span class="var type1" id="S26T4U674">m_2</span></span>*<span class="mxinfo " id="T4:U522"><span class="var type1" id="S39T4U676">x_2</span>^2</span></span></span> + <span class="mxinfo " id="T4:U524"><span class="mxinfo " id="T4:U525"><span class="mxinfo " id="T4:U526"><span class="mxinfo " id="T4:U527"><span class="mxinfo " id="T4:U528"><span class="mxinfo " id="T4:U529">36</span>*<span class="mxinfo " id="T4:U530"><span class="var type1" id="S23T4U685">l_1</span>^2</span></span>*<span class="var type1" id="S24T4U687">l_2</span></span>*<span class="var type1" id="S26T4U688">m_2</span></span>*<span class="var type1" id="S27T4U689">m_3</span></span>*<span class="mxinfo " id="T4:U535"><span class="var type1" id="S39T4U691">x_2</span>^2</span></span></span>)</span> + <span class="mxinfo " id="T4:U537"><span class="mxinfo " id="T4:U538"><span class="mxinfo " id="T4:U539"><span class="mxinfo " id="T4:U540"><span class="mxinfo " id="T4:U541">24</span>*<span class="var type1" id="S29T4U698">d_p2</span></span>*<span class="var type1" id="S23T4U699">l_1</span></span>*<span class="var type1" id="S25T4U700">m_1</span></span>*<span class="var type1" id="S39T4U701">x_2</span></span></span> + <span class="mxinfo " id="T4:U546"><span class="mxinfo " id="T4:U547"><span class="mxinfo " id="T4:U548"><span class="mxinfo " id="T4:U549"><span class="mxinfo " id="T4:U550">72</span>*<span class="var type1" id="S29T4U707">d_p2</span></span>*<span class="var type1" id="S23T4U708">l_1</span></span>*<span class="var type1" id="S26T4U709">m_2</span></span>*<span class="var type1" id="S39T4U710">x_2</span></span></span> - <span class="mxinfo " id="T4:U555"><span class="mxinfo " id="T4:U556"><span class="mxinfo " id="T4:U557"><span class="mxinfo " id="T4:U558"><span class="mxinfo " id="T4:U559">24</span>*<span class="var type1" id="S29T4U716">d_p2</span></span>*<span class="var type1" id="S23T4U717">l_1</span></span>*<span class="var type1" id="S25T4U718">m_1</span></span>*<span class="var type1" id="S41T4U719">x_4</span></span></span> + <span class="mxinfo " id="T4:U564"><span class="mxinfo " id="T4:U565"><span class="mxinfo " id="T4:U566"><span class="mxinfo " id="T4:U567"><span class="mxinfo " id="T4:U568">72</span>*<span class="var type1" id="S29T4U725">d_p2</span></span>*<span class="var type1" id="S23T4U726">l_1</span></span>*<span class="var type1" id="S27T4U727">m_3</span></span>*<span class="var type1" id="S39T4U728">x_2</span></span></span> - <span class="mxinfo " id="T4:U573"><span class="mxinfo " id="T4:U574"><span class="mxinfo " id="T4:U575"><span class="mxinfo " id="T4:U576"><span class="mxinfo " id="T4:U577">72</span>*<span class="var type1" id="S29T4U734">d_p2</span></span>*<span class="var type1" id="S23T4U735">l_1</span></span>*<span class="var type1" id="S26T4U736">m_2</span></span>*<span class="var type1" id="S41T4U737">x_4</span></span></span> - <span class="mxinfo " id="T4:U582"><span class="mxinfo " id="T4:U583"><span class="mxinfo " id="T4:U584"><span class="mxinfo " id="T4:U585"><span class="mxinfo " id="T4:U586">72</span>*<span class="var type1" id="S29T4U743">d_p2</span></span>*<span class="var type1" id="S23T4U744">l_1</span></span>*<span class="var type1" id="S27T4U745">m_3</span></span>*<span class="var type1" id="S41T4U746">x_4</span></span></span> + <span class="mxinfo " id="T4:U591"><span class="mxinfo " id="T4:U592"><span class="mxinfo " id="T4:U593"><span class="mxinfo " id="T4:U594"><span class="mxinfo " id="T4:U595"><span class="mxinfo " id="T4:U596">36</span>*<span class="var type1" id="S28T4U753">d_p1</span></span>*<span class="var type1" id="S24T4U754">l_2</span></span>*<span class="var type1" id="S26T4U755">m_2</span></span>*<span class="var type1" id="S39T4U756">x_2</span></span>*<span class="mxinfo " id="T4:U601">cos(<span class="mxinfo " id="T4:U602"><span class="var type1" id="S38T4U760">x_1</span> - <span class="var type1" id="S40T4U761">x_3</span></span>)</span></span></span> + <span class="mxinfo " id="T4:U605"><span class="mxinfo " id="T4:U606"><span class="mxinfo " id="T4:U607"><span class="mxinfo " id="T4:U608"><span class="mxinfo " id="T4:U609"><span class="mxinfo " id="T4:U610">36</span>*<span class="var type1" id="S29T4U768">d_p2</span></span>*<span class="var type1" id="S24T4U769">l_2</span></span>*<span class="var type1" id="S26T4U770">m_2</span></span>*<span class="var type1" id="S39T4U771">x_2</span></span>*<span class="mxinfo " id="T4:U615">cos(<span class="mxinfo " id="T4:U616"><span class="var type1" id="S38T4U775">x_1</span> - <span class="var type1" id="S40T4U776">x_3</span></span>)</span></span></span> - <span class="mxinfo " id="T4:U619"><span class="mxinfo " id="T4:U620"><span class="mxinfo " id="T4:U621"><span class="mxinfo " id="T4:U622"><span class="mxinfo " id="T4:U623"><span class="mxinfo " id="T4:U624">36</span>*<span class="var type1" id="S29T4U783">d_p2</span></span>*<span class="var type1" id="S24T4U784">l_2</span></span>*<span class="var type1" id="S26T4U785">m_2</span></span>*<span class="var type1" id="S41T4U786">x_4</span></span>*<span class="mxinfo " id="T4:U629">cos(<span class="mxinfo " id="T4:U630"><span class="var type1" id="S38T4U790">x_1</span> - <span class="var type1" id="S40T4U791">x_3</span></span>)</span></span></span> + <span class="mxinfo " id="T4:U633"><span class="mxinfo " id="T4:U634"><span class="mxinfo " id="T4:U635"><span class="mxinfo " id="T4:U636"><span class="mxinfo " id="T4:U637"><span class="mxinfo " id="T4:U638">18</span>*<span class="var type1" id="S23T4U798">l_1</span></span>*<span class="var type1" id="S24T4U799">l_2</span></span>*<span class="mxinfo " id="T4:U641"><span class="var type1" id="S26T4U801">m_2</span>^2</span></span>*<span class="var type1" id="S13T4U803">u</span></span>*<span class="mxinfo " id="T4:U644">cos(<span class="var type1" id="S40T4U806">x_3</span>)</span></span></span> + <span class="mxinfo " id="T4:U646"><span class="mxinfo " id="T4:U647"><span class="mxinfo " id="T4:U648"><span class="mxinfo " id="T4:U649"><span class="mxinfo " id="T4:U650"><span class="mxinfo " id="T4:U651">18</span>*<span class="var type1" id="S22T4U813">g</span></span>*<span class="var type1" id="S23T4U814">l_1</span></span>*<span class="var type1" id="S24T4U815">l_2</span></span>*<span class="mxinfo " id="T4:U655"><span class="var type1" id="S26T4U817">m_2</span>^2</span></span>*<span class="mxinfo " id="T4:U657">sin(<span class="var type1" id="S40T4U821">x_3</span>)</span></span></span> + <span class="mxinfo " id="T4:U659"><span class="mxinfo " id="T4:U660"><span class="mxinfo " id="T4:U661"><span class="mxinfo " id="T4:U662"><span class="mxinfo " id="T4:U663"><span class="mxinfo " id="T4:U664">9</span>*<span class="var type1" id="S23T4U828">l_1</span></span>*<span class="mxinfo " id="T4:U666"><span class="var type1" id="S24T4U830">l_2</span>^2</span></span>*<span class="mxinfo " id="T4:U668"><span class="var type1" id="S26T4U833">m_2</span>^2</span></span>*<span class="mxinfo " id="T4:U670"><span class="var type1" id="S41T4U836">x_4</span>^2</span></span>*<span class="mxinfo " id="T4:U672">sin(<span class="mxinfo " id="T4:U673"><span class="mxinfo " id="T4:U674"><span class="mxinfo " id="T4:U675">2</span>*<span class="var type1" id="S38T4U843">x_1</span></span> - <span class="mxinfo " id="T4:U677"><span class="mxinfo " id="T4:U678">2</span>*<span class="var type1" id="S40T4U846">x_3</span></span></span>)</span></span></span> - <span class="mxinfo " id="T4:U680"><span class="mxinfo " id="T4:U681"><span class="mxinfo " id="T4:U682"><span class="mxinfo " id="T4:U683"><span class="mxinfo " id="T4:U684"><span class="mxinfo " id="T4:U685">18</span>*<span class="var type1" id="S23T4U853">l_1</span></span>*<span class="var type1" id="S24T4U854">l_2</span></span>*<span class="mxinfo " id="T4:U688"><span class="var type1" id="S26T4U856">m_2</span>^2</span></span>*<span class="var type1" id="S13T4U858">u</span></span>*<span class="mxinfo " id="T4:U691">cos(<span class="mxinfo " id="T4:U692"><span class="mxinfo " id="T4:U693"><span class="mxinfo " id="T4:U694">2</span>*<span class="var type1" id="S38T4U864">x_1</span></span> - <span class="var type1" id="S40T4U865">x_3</span></span>)</span></span></span> - <span class="mxinfo " id="T4:U697"><span class="mxinfo " id="T4:U698"><span class="mxinfo " id="T4:U699"><span class="mxinfo " id="T4:U700"><span class="mxinfo " id="T4:U701"><span class="mxinfo " id="T4:U702">18</span>*<span class="var type1" id="S22T4U872">g</span></span>*<span class="var type1" id="S23T4U873">l_1</span></span>*<span class="var type1" id="S24T4U874">l_2</span></span>*<span class="mxinfo " id="T4:U706"><span class="var type1" id="S26T4U876">m_2</span>^2</span></span>*<span class="mxinfo " id="T4:U708">sin(<span class="mxinfo " id="T4:U709"><span class="mxinfo " id="T4:U710"><span class="mxinfo " id="T4:U711">2</span>*<span class="var type1" id="S38T4U883">x_1</span></span> - <span class="var type1" id="S40T4U884">x_3</span></span>)</span></span></span> + <span class="mxinfo " id="T4:U714"><span class="mxinfo " id="T4:U715"><span class="mxinfo " id="T4:U716"><span class="mxinfo " id="T4:U717"><span class="mxinfo " id="T4:U718"><span class="mxinfo " id="T4:U719"><span class="mxinfo " id="T4:U720">3</span>*<span class="var type1" id="S23T4U892">l_1</span></span>*<span class="var type1" id="S24T4U893">l_2</span></span>*<span class="var type1" id="S25T4U894">m_1</span></span>*<span class="var type1" id="S26T4U895">m_2</span></span>*<span class="var type1" id="S13T4U896">u</span></span>*<span class="mxinfo " id="T4:U726">cos(<span class="var type1" id="S40T4U899">x_3</span>)</span></span></span> + <span class="mxinfo " id="T4:U728"><span class="mxinfo " id="T4:U729"><span class="mxinfo " id="T4:U730"><span class="mxinfo " id="T4:U731"><span class="mxinfo " id="T4:U732"><span class="mxinfo " id="T4:U733"><span class="mxinfo " id="T4:U734">18</span>*<span class="var type1" id="S23T4U907">l_1</span></span>*<span class="var type1" id="S24T4U908">l_2</span></span>*<span class="var type1" id="S26T4U909">m_2</span></span>*<span class="var type1" id="S27T4U910">m_3</span></span>*<span class="var type1" id="S13T4U911">u</span></span>*<span class="mxinfo " id="T4:U740">cos(<span class="var type1" id="S40T4U914">x_3</span>)</span></span></span> + <span class="mxinfo " id="T4:U742"><span class="mxinfo " id="T4:U743"><span class="mxinfo " id="T4:U744"><span class="mxinfo " id="T4:U745"><span class="mxinfo " id="T4:U746"><span class="mxinfo " id="T4:U747"><span class="mxinfo " id="T4:U748">3</span>*<span class="var type1" id="S22T4U922">g</span></span>*<span class="var type1" id="S23T4U923">l_1</span></span>*<span class="var type1" id="S24T4U924">l_2</span></span>*<span class="var type1" id="S25T4U925">m_1</span></span>*<span class="var type1" id="S26T4U926">m_2</span></span>*<span class="mxinfo " id="T4:U754">sin(<span class="var type1" id="S40T4U929">x_3</span>)</span></span></span> + <span class="mxinfo " id="T4:U756"><span class="mxinfo " id="T4:U757"><span class="mxinfo " id="T4:U758"><span class="mxinfo " id="T4:U759"><span class="mxinfo " id="T4:U760"><span class="mxinfo " id="T4:U761"><span class="mxinfo " id="T4:U762">18</span>*<span class="var type1" id="S22T4U937">g</span></span>*<span class="var type1" id="S23T4U938">l_1</span></span>*<span class="var type1" id="S24T4U939">l_2</span></span>*<span class="var type1" id="S26T4U940">m_2</span></span>*<span class="var type1" id="S27T4U941">m_3</span></span>*<span class="mxinfo " id="T4:U768">sin(<span class="var type1" id="S40T4U944">x_3</span>)</span></span></span> - <span class="mxinfo " id="T4:U770"><span class="mxinfo " id="T4:U771"><span class="mxinfo " id="T4:U772"><span class="mxinfo " id="T4:U773"><span class="mxinfo " id="T4:U774"><span class="mxinfo " id="T4:U775"><span class="mxinfo " id="T4:U776">9</span>*<span class="var type1" id="S23T4U952">l_1</span></span>*<span class="var type1" id="S24T4U953">l_2</span></span>*<span class="var type1" id="S25T4U954">m_1</span></span>*<span class="var type1" id="S26T4U955">m_2</span></span>*<span class="var type1" id="S13T4U956">u</span></span>*<span class="mxinfo " id="T4:U782">cos(<span class="mxinfo " id="T4:U783"><span class="mxinfo " id="T4:U784"><span class="mxinfo " id="T4:U785">2</span>*<span class="var type1" id="S38T4U962">x_1</span></span> - <span class="var type1" id="S40T4U963">x_3</span></span>)</span></span></span> - <span class="mxinfo " id="T4:U788"><span class="mxinfo " id="T4:U789"><span class="mxinfo " id="T4:U790"><span class="mxinfo " id="T4:U791"><span class="mxinfo " id="T4:U792"><span class="mxinfo " id="T4:U793"><span class="mxinfo " id="T4:U794">18</span>*<span class="var type1" id="S23T4U971">l_1</span></span>*<span class="var type1" id="S24T4U972">l_2</span></span>*<span class="var type1" id="S26T4U973">m_2</span></span>*<span class="var type1" id="S27T4U974">m_3</span></span>*<span class="var type1" id="S13T4U975">u</span></span>*<span class="mxinfo " id="T4:U800">cos(<span class="mxinfo " id="T4:U801"><span class="mxinfo " id="T4:U802"><span class="mxinfo " id="T4:U803">2</span>*<span class="var type1" id="S38T4U981">x_1</span></span> - <span class="var type1" id="S40T4U982">x_3</span></span>)</span></span></span> - <span class="mxinfo " id="T4:U806"><span class="mxinfo " id="T4:U807"><span class="mxinfo " id="T4:U808"><span class="mxinfo " id="T4:U809"><span class="mxinfo " id="T4:U810"><span class="mxinfo " id="T4:U811"><span class="mxinfo " id="T4:U812">9</span>*<span class="var type1" id="S22T4U990">g</span></span>*<span class="var type1" id="S23T4U991">l_1</span></span>*<span class="var type1" id="S24T4U992">l_2</span></span>*<span class="var type1" id="S25T4U993">m_1</span></span>*<span class="var type1" id="S26T4U994">m_2</span></span>*<span class="mxinfo " id="T4:U818">sin(<span class="mxinfo " id="T4:U819"><span class="mxinfo " id="T4:U820"><span class="mxinfo " id="T4:U821">2</span>*<span class="var type1" id="S38T4U1000">x_1</span></span> - <span class="var type1" id="S40T4U1001">x_3</span></span>)</span></span></span> - <span class="mxinfo " id="T4:U824"><span class="mxinfo " id="T4:U825"><span class="mxinfo " id="T4:U826"><span class="mxinfo " id="T4:U827"><span class="mxinfo " id="T4:U828"><span class="mxinfo " id="T4:U829"><span class="mxinfo " id="T4:U830">18</span>*<span class="var type1" id="S22T4U1009">g</span></span>*<span class="var type1" id="S23T4U1010">l_1</span></span>*<span class="var type1" id="S24T4U1011">l_2</span></span>*<span class="var type1" id="S26T4U1012">m_2</span></span>*<span class="var type1" id="S27T4U1013">m_3</span></span>*<span class="mxinfo " id="T4:U836">sin(<span class="mxinfo " id="T4:U837"><span class="mxinfo " id="T4:U838"><span class="mxinfo " id="T4:U839">2</span>*<span class="var type1" id="S38T4U1019">x_1</span></span> - <span class="var type1" id="S40T4U1020">x_3</span></span>)</span></span></span>)</span>)/(<span class="mxinfo " id="T4:U842"><span class="mxinfo " id="T4:U843"><span class="mxinfo " id="T4:U844"><span class="var type1" id="S23T4U1025">l_1</span>*<span class="mxinfo " id="T4:U846"><span class="var type1" id="S24T4U1027">l_2</span>^2</span></span>*<span class="var type1" id="S26T4U1029">m_2</span></span>*(<span class="mxinfo " id="T4:U849"><span class="mxinfo " id="T4:U850"><span class="mxinfo " id="T4:U851"><span class="mxinfo " id="T4:U852"><span class="mxinfo " id="T4:U853">8</span>*<span class="var type1" id="S25T4U1036">m_1</span></span> + <span class="mxinfo " id="T4:U855"><span class="mxinfo " id="T4:U856">15</span>*<span class="var type1" id="S26T4U1039">m_2</span></span></span> + <span class="mxinfo " id="T4:U858"><span class="mxinfo " id="T4:U859">24</span>*<span class="var type1" id="S27T4U1042">m_3</span></span></span> - <span class="mxinfo " id="T4:U861"><span class="mxinfo " id="T4:U862"><span class="mxinfo " id="T4:U863">9</span>*<span class="var type1" id="S26T4U1046">m_2</span></span>*<span class="mxinfo " id="T4:U865">cos(<span class="mxinfo " id="T4:U866"><span class="mxinfo " id="T4:U867"><span class="mxinfo " id="T4:U868">2</span>*<span class="var type1" id="S38T4U1052">x_1</span></span> - <span class="mxinfo " id="T4:U870"><span class="mxinfo " id="T4:U871">2</span>*<span class="var type1" id="S40T4U1055">x_3</span></span></span>)</span></span></span>)</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo " id="T7:U873"><span class="var type1" id="S44T7U1058">y_sig</span>= <span class="mxinfo " id="T7:U875"><span class="mxinfo " id="T13:U876">[1 0 0 0]</span> * <span class="var type1" id="S18T6U1066">x_sig</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% Prediction, weighted sum</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo " id="T1:U878"><span class="var type1" id="S15T1U1069">x_p</span>  = <span class="mxinfo " id="T1:U880"><span class="var type1" id="S18T6U1071">x_sig</span> * <span class="mxinfo " id="T11:U882"><span class="var type1" id="S19T7U1073">W_m</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="mxinfo " id="T4:U884"><span class="var type1" id="S45T4U1076">y_</span>  = <span class="mxinfo " id="T4:U886"><span class="var type1" id="S44T7U1078">y_sig</span> * <span class="mxinfo " id="T11:U888"><span class="var type1" id="S19T7U1080">W_m</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%P_p calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="mxinfo " id="T3:U890"><span class="var type1" id="S16T3U1083">P_p</span> = <span class="mxinfo " id="T3:U892"><span class="var type1" id="S16T3U1085">P_p</span> .* <span class="mxinfo " id="T4:U894">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T4U1089">i</span>=<span class="mxinfo " id="T11:U896"><span class="mxinfo " id="T4:U897">1</span>:(2*<span class="var type1" id="S30T4U1096">n_ukf</span>+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">    <span class="var type0" id="S16T0U1100">P_p</span> = <span class="message error" id="M3F1C"><span class="var type1" id="S16T3U1102">P_p</span> + (<span class="mxinfo " id="T2:U900"><span class="mxinfo " id="T2:U901">(<span class="mxinfo " id="T1:U902"><span class="mxinfo " id="T1:U903"><span class="var type1" id="S18T6U1109">x_sig</span>(<span class="mxinfo " id="T10:U905">:</span>,<span class="var type1" id="S34T4U1111">i</span>)</span> - <span class="var type1" id="S15T1U1112">x_p</span></span>) * <span class="mxinfo " id="T13:U908">(<span class="mxinfo " id="T1:U909"><span class="mxinfo " id="T1:U910"><span class="var type1" id="S18T6U1117">x_sig</span>(<span class="mxinfo " id="T10:U912">:</span>,<span class="var type1" id="S34T4U1119">i</span>)</span> - <span class="var type1" id="S15T1U1120">x_p</span></span>)'</span></span> .* <span class="mxinfo " id="T4:U915"><span class="var type1" id="S20T7U1122">W_c</span>(<span class="mxinfo " id="T4:U917">1</span>,<span class="var type1" id="S34T4U1124">i</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="var type0" id="S16T0U1127">P_p</span>  = <span class="message error" id="M4F1C"><span class="var type1" id="S16T3U1129">P_p</span> + <span class="var type1" id="S5T2U1130">Q</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%% Unscented Kalman filter measurement update equations</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% Pyy calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo " id="T4:U921"><span class="var type1" id="S46T4U1133">P_yy</span> = <span class="mxinfo " id="T4:U923">zeros(<span class="var type1" id="S31T4U1136">o_ukf</span>,<span class="var type1" id="S31T4U1137">o_ukf</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T4U1140">i</span>=<span class="mxinfo " id="T11:U927"><span class="mxinfo " id="T4:U928">1</span>:(2*<span class="var type1" id="S30T4U1147">n_ukf</span>+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    <span class="mxinfo " id="T4:U930"><span class="var type1" id="S46T4U1151">P_yy</span> = <span class="mxinfo " id="T4:U932"><span class="var type1" id="S46T4U1153">P_yy</span> + (<span class="mxinfo " id="T4:U934"><span class="mxinfo " id="T4:U935">(<span class="mxinfo " id="T4:U936"><span class="mxinfo " id="T4:U937"><span class="var type1" id="S44T7U1160">y_sig</span>(<span class="mxinfo " id="T8:U939">:</span>,<span class="var type1" id="S34T4U1162">i</span>)</span> - <span class="var type1" id="S45T4U1163">y_</span></span>) * (<span class="mxinfo " id="T4:U942"><span class="mxinfo " id="T4:U943"><span class="var type1" id="S44T7U1168">y_sig</span>(<span class="mxinfo " id="T8:U945">:</span>,<span class="var type1" id="S34T4U1170">i</span>)</span> - <span class="var type1" id="S45T4U1171">y_</span></span>)'</span> .* <span class="mxinfo " id="T4:U948"><span class="var type1" id="S20T7U1173">W_c</span>(<span class="mxinfo " id="T4:U950">1</span>,<span class="var type1" id="S34T4U1175">i</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="mxinfo " id="T4:U952"><span class="var type1" id="S46T4U1178">P_yy</span> = <span class="mxinfo " id="T4:U954"><span class="var type1" id="S46T4U1180">P_yy</span> + <span class="var type1" id="S6T4U1181">R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">% Pxy calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo " id="T1:U957"><span class="var type1" id="S47T1U1184">P_xy</span> = <span class="mxinfo " id="T1:U959">zeros(<span class="var type1" id="S30T4U1187">n_ukf</span>,<span class="var type1" id="S31T4U1188">o_ukf</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T4U1191">i</span>=<span class="mxinfo " id="T11:U963"><span class="mxinfo " id="T4:U964">1</span>:(2*<span class="var type1" id="S30T4U1198">n_ukf</span>+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">    <span class="mxinfo " id="T1:U966"><span class="var type1" id="S47T1U1202">P_xy</span> = <span class="mxinfo " id="T1:U968"><span class="var type1" id="S47T1U1204">P_xy</span>+(<span class="mxinfo " id="T1:U970"><span class="mxinfo " id="T1:U971">(<span class="mxinfo " id="T1:U972"><span class="mxinfo " id="T1:U973"><span class="var type1" id="S18T6U1211">x_sig</span>(<span class="mxinfo " id="T10:U975">:</span>,<span class="var type1" id="S34T4U1213">i</span>)</span>-<span class="var type1" id="S15T1U1214">x_p</span></span>)*(<span class="mxinfo " id="T4:U978"><span class="mxinfo " id="T4:U979"><span class="var type1" id="S44T7U1219">y_sig</span>(<span class="mxinfo " id="T8:U981">:</span>,<span class="var type1" id="S34T4U1221">i</span>)</span>-<span class="var type1" id="S45T4U1222">y_</span></span>)'</span>.*<span class="mxinfo " id="T4:U984"><span class="var type1" id="S20T7U1224">W_c</span>(<span class="mxinfo " id="T4:U986">1</span>,<span class="var type1" id="S34T4U1226">i</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">% Kalman Gain</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T1:U988"><span class="var type1" id="S48T1U1229">K</span>  = <span class="mxinfo " id="T1:U990"><span class="var type1" id="S47T1U1231">P_xy</span>/(<span class="var type1" id="S46T4U1233">P_yy</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="var type0" id="S16T0U1236">P_p</span> = <span class="message error" id="M5F1C"><span class="var type1" id="S16T3U1238">P_p</span> - (<span class="mxinfo " id="T2:U994"><span class="mxinfo " id="T1:U995"><span class="var type1" id="S48T1U1242">K</span> * <span class="var type1" id="S46T4U1243">P_yy</span></span> * <span class="mxinfo " id="T13:U998"><span class="var type1" id="S48T1U1245">K</span>'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T1:U1000"><span class="var type1" id="S2T1U1248">x</span>  = <span class="mxinfo " id="T1:U1002"><span class="var type1" id="S15T1U1250">x_p</span> +  <span class="mxinfo " id="T1:U1004"><span class="var type1" id="S48T1U1252">K</span> * ( <span class="mxinfo " id="T4:U1006"><span class="var type1" id="S14T4U1255">y</span> - <span class="var type1" id="S45T4U1256">y_</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T1:U1009"><span class="var type1" id="S15T1U1259">x_p</span> = <span class="var type1" id="S2T1U1260">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
